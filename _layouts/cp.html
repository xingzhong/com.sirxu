---
layout: index
---
<div class="ticker" style="display:none">
{{ content }}
</div>
<form class="pure-form" id="CPSearch">
    <input type="text" class="pure-input-rounded" id='ticker' value='AAPL' style="text-transform:uppercase;">
    <button type="submit" class="pure-button">Search</button>
</form>
<div id="comment">
	<h2 id="ticker" style="text-transform:uppercase;"> </h2>
	Latest Option Chain: <span id="expire"></span>
</div>
<div id="chart"></div>
<div class="note">
   * Data from Yahoo Finance. Options data may not accurate!
</div>

<link rel="stylesheet" type="text/css" href="/css/c3.css">
<script src="/js/d3.v3.min.js"></script>
<script src="/js/c3.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
<script type='text/javascript'>
	function optionChain(chain) {
		_.each(chain, function(o) {
			o.vol = parseInt(o.vol);
		});
		options = _.groupBy(chain, 'type');
		calls = _.indexBy(options.C, 'strikePrice');
		puts = _.indexBy(options.P, 'strikePrice');
		strikes = _.sortBy(
			_.intersection(_.keys(calls), _.keys(puts)), 
			function(a){return parseFloat(a)});
		//console.log(calls)
		options = _.map(strikes, function(s) {
			return [s, calls[s].vol, puts[s].vol]
		})
		options.unshift(['strikePrice', 'Call Vol', 'Put Vol'])
		//console.log(options)
		return options;
		
	}

	function startCP(t) {
		console.log(t);
		d3.json("http://query.yahooapis.com/v1/public/yql?q=SELECT%20*%20FROM%20yahoo.finance.option_contracts%20WHERE%20symbol%3D'"+t+"'&diagnostics=true&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys", function(data) {
			//console.log(data.query)
			if (data.query.results) {
				var ticker = data.query.results.option.symbol;
				var contracts = data.query.results.option.contract;
				
				d3.json("http://query.yahooapis.com/v1/public/yql?q=SELECT%20*%20FROM%20yahoo.finance.options%20WHERE%20symbol%3D'"+ticker+"'%20AND%20expiration%3D'"+contracts[0]+"'&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=", function(data) {
					if (data.query.results) {
						var chain = data.query.results.optionsChain;
						//console.log(chain);
						var expire = chain.expiration;
						var options = chain.option;
						c3.generate({
							data:{
								x: 'strikePrice',
								rows: optionChain(options),
								type: 'bar'
							}
						});
						$("#comment #ticker").text(ticker);
						$("#comment #expire").text(expire);
					}
				})
			}
			
		})
	}
</script>
